---
description: 
globs: 
alwaysApply: true
---
# JSON2Dart å®‰å…¨è§£ææ’ä»¶æ–‡æ¡£

## ğŸš¨ é‡è¦ç¼–ç è§„èŒƒ

### ğŸ“Œ è§„åˆ™ 1ï¼šé»˜è®¤å€¼ä½¿ç”¨åŸåˆ™
**åªæœ‰å½“ç”¨æˆ·æ˜ç¡®æŒ‡å‡ºè¦æ·»åŠ é»˜è®¤å€¼æ—¶ï¼Œæ‰éœ€è¦æ·»åŠ é»˜è®¤å€¼ã€‚å¦‚æœæ²¡æœ‰ç‰¹åˆ«è¯´æ˜ï¼Œé»˜è®¤æ˜¯ä¸åŠ é»˜è®¤å€¼çš„ã€‚**

### ğŸ“Œ è§„åˆ™ 2ï¼šæ¡ä»¶æ€§ Map å­—æ®µæ·»åŠ è§„èŒƒ
**ç¦æ­¢ä½¿ç”¨å…ˆåˆ›å»º Map å†å•ç‹¬æ·»åŠ å­—æ®µçš„æ–¹å¼ï¼Œåº”è¯¥ç›´æ¥åœ¨ Map å­—é¢é‡ä¸­ä½¿ç”¨æ¡ä»¶è¯­æ³•ã€‚**

### ğŸ“Œ è§„åˆ™ 3ï¼šåŸºç¡€ç±»å‹éç©ºå£°æ˜
**åŸºç¡€ç±»å‹ï¼ˆStringã€boolã€doubleã€intã€numç­‰ï¼‰åº”è¯¥å®šä¹‰æˆénullableç±»å‹ï¼Œå› ä¸ºè§£ææ–¹æ³•é»˜è®¤ä¼šè¿”å›ç›¸åº”çš„é»˜è®¤å€¼ã€‚**

### ğŸ“Œ è§„åˆ™ 4ï¼šæ¨¡å‹è§£æå‡½æ•°å¼•ç”¨
**åœ¨è§£ææ¨¡å‹æ—¶ï¼Œåº”è¯¥ç›´æ¥ä¼ é€’æ„é€ å‡½æ•°å¼•ç”¨ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ lambda è¡¨è¾¾å¼ã€‚**

### ğŸ“Œ è§„åˆ™ 5ï¼šå¤šå­—æ®µè§£æä½¿ç”¨åŸåˆ™
**åªæœ‰å½“ç”¨æˆ·æ˜ç¡®æŒ‡å‡ºè¦ä½¿ç”¨å¤šå­—æ®µè§£ææ—¶ï¼Œæ‰ä½¿ç”¨å¤šå­—æ®µè§£ææ–¹æ³•ã€‚å¦‚æœæ²¡æœ‰æ˜ç¡®è¯´æ˜ï¼Œä¿æŒä½¿ç”¨å•å­—æ®µè§£æã€‚**

### ğŸ“Œ è§„åˆ™ 6ï¼šæ¨¡å‹ç±»å¿…å¤‡æ–¹æ³•è§„èŒƒ
**æ‰€æœ‰æ¨¡å‹ç±»å¿…é¡»åŒ…å« fromJsonã€toJson å’Œ copyWith ä¸‰ä¸ªæ–¹æ³•ï¼Œç¡®ä¿å®Œæ•´çš„åºåˆ—åŒ–ã€ååºåˆ—åŒ–å’Œä¸å¯å˜å¯¹è±¡æ›´æ–°èƒ½åŠ›ã€‚**
**æ‰€æœ‰çš„ä»£ç å¿…é¡»åŸºäºjson2dart_safeç¼–å†™ï¼Œå…·ä½“æŸ¥çœ‹ä¸‹é¢çš„ç¤ºä¾‹**

```dart
// âŒ é”™è¯¯å†™æ³•
final data = {'success': success, 'message': message};
if (token != null) data['token'] = token!;

// âœ… æ­£ç¡®å†™æ³•
final data = {
  'success': success,
  'message': message,
  if (token != null) 'token': token,
};

// ğŸ“Œ å¤šå­—æ®µè§£æç¤ºä¾‹
// âœ… æ­£ç¡®ï¼šç”¨æˆ·æ˜ç¡®è¦æ±‚æ—¶ä½¿ç”¨
final userName = json.asStrings(['username', 'name', 'displayName']);

// âŒ é”™è¯¯ï¼šæ²¡æœ‰æ˜ç¡®éœ€æ±‚å°±ä½¿ç”¨å¤šå­—æ®µè§£æ
final name = json.asStrings(['name']);  // åº”è¯¥ç”¨ json.asString('name')

// ğŸ“Œ æ¨¡å‹ç±»å¿…å¤‡æ–¹æ³•
class User {
  final String name;
  User({required this.name});

  // å¿…é¡»ï¼šJSONååºåˆ—åŒ–
  factory User.fromJson(Map<String, dynamic> json) => User(name: json.asString('name'));

  // å¿…é¡»ï¼šJSONåºåˆ—åŒ–
  Map<String, dynamic> toJson() => {'name': name};

  // å¿…é¡»ï¼šä¸å¯å˜å¯¹è±¡æ›´æ–°
  User copyWith({String? name}) => User(name: name ?? this.name);
}
```

### ğŸ“Œ è§„åˆ™ 3ï¼šåŸºç¡€ç±»å‹éç©ºå£°æ˜è§„èŒƒ
**åŸºç¡€ç±»å‹ï¼ˆStringã€boolã€doubleã€intã€numç­‰ï¼‰åº”è¯¥å®šä¹‰æˆénullableç±»å‹ï¼Œå› ä¸ºè§£ææ–¹æ³•é»˜è®¤ä¼šè¿”å›ç›¸åº”çš„é»˜è®¤å€¼ã€‚**

```dart
// âœ… æ­£ç¡®ï¼šåŸºç¡€ç±»å‹ä½¿ç”¨éç©ºå£°æ˜
class User {
  final String name;        // éç©ºï¼Œå› ä¸º asString è¿”å›é»˜è®¤ç©ºå­—ç¬¦ä¸²
  final int age;           // éç©ºï¼Œå› ä¸º asInt è¿”å›é»˜è®¤ 0
  final bool isActive;     // éç©ºï¼Œå› ä¸º asBool è¿”å›é»˜è®¤ false
  final double score;      // éç©ºï¼Œå› ä¸º asDouble è¿”å›é»˜è®¤ 0.0

  // å¤æ‚ç±»å‹ä½¿ç”¨å¯ç©ºå£°æ˜
  final UserProfile? profile;  // å¯ç©ºï¼Œå› ä¸º asBean å¯èƒ½è¿”å› null
  final List<String>? tags;    // å¯ç©ºï¼Œå› ä¸º asList å¯èƒ½è¿”å› null
}
```

### ğŸ“Œ è§„åˆ™ 4ï¼šæ¨¡å‹è§£æå‡½æ•°å¼•ç”¨è§„èŒƒ
**åœ¨è§£ææ¨¡å‹æ—¶ï¼Œåº”è¯¥ç›´æ¥ä¼ é€’æ„é€ å‡½æ•°å¼•ç”¨ï¼Œåˆ©ç”¨ Dart çš„é«˜çº§ç‰¹æ€§ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ lambda è¡¨è¾¾å¼ã€‚**

```dart
// âœ… æ­£ç¡®å†™æ³•ï¼šç›´æ¥ä¼ é€’æ„é€ å‡½æ•°å¼•ç”¨
final user = json.asBean<User>('user', User.fromJson);
final users = json.asList<User>('users', User.fromJson);

// âŒ é”™è¯¯å†™æ³•ï¼šä½¿ç”¨ä¸å¿…è¦çš„ lambda è¡¨è¾¾å¼
final user = json.asBean<User>('user', (json) => User.fromJson(json));
final users = json.asList<User>('users', (json) => User.fromJson(json));
```

### ğŸ“Œ è§„åˆ™ 5ï¼šå¤šå­—æ®µè§£æä½¿ç”¨åŸåˆ™
**åªæœ‰å½“ç”¨æˆ·æ˜ç¡®æŒ‡å‡ºè¦ä½¿ç”¨å¤šå­—æ®µè§£ææ—¶ï¼Œæ‰ä½¿ç”¨å¤šå­—æ®µè§£ææ–¹æ³•ï¼ˆasStringsã€asIntsã€asBoolsç­‰ï¼‰ã€‚å¦‚æœæ²¡æœ‰æ˜ç¡®è¯´æ˜ï¼Œä¿æŒä½¿ç”¨å•å­—æ®µè§£æã€‚**

```dart
// âœ… æ­£ç¡®ï¼šé»˜è®¤ä½¿ç”¨å•å­—æ®µè§£æ
final name = json.asString('name');
final age = json.asInt('age');
final isActive = json.asBool('isActive');

// âœ… æ­£ç¡®ï¼šç”¨æˆ·æ˜ç¡®è¦æ±‚å¤šå­—æ®µè§£ææ—¶
// ç”¨æˆ·è¯´ï¼š"å°è¯•ä» usernameã€nameã€displayName å­—æ®µä¸­è·å–ç”¨æˆ·å"
final userName = json.asStrings(['username', 'name', 'displayName']);

// âŒ é”™è¯¯ï¼šè‡ªåŠ¨ä½¿ç”¨å¤šå­—æ®µè§£æ
final name = json.asStrings(['name']);  // ä¸å¿…è¦çš„å¤šå­—æ®µè§£æ
```

## ğŸ“– ç¼–ç è§„åˆ™æ·±åº¦è§£æ

### ğŸ” è§„åˆ™ 3 æ·±åº¦è§£æï¼šåŸºç¡€ç±»å‹çš„é»˜è®¤å€¼æœºåˆ¶

json2dart_safe åº“ä¸ºæ¯ç§åŸºç¡€ç±»å‹æä¾›äº†å†…ç½®çš„é»˜è®¤å€¼ï¼š

| ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|-------|------|
| `String` | `''` (ç©ºå­—ç¬¦ä¸²) | ç¡®ä¿å­—ç¬¦ä¸²æ“ä½œçš„å®‰å…¨æ€§ |
| `int` | `0` | æ•°å€¼è®¡ç®—çš„ä¸­æ€§å…ƒç´  |
| `double` | `0.0` | æµ®ç‚¹è®¡ç®—çš„ä¸­æ€§å…ƒç´  |
| `bool` | `false` | å¸ƒå°”é€»è¾‘çš„å®‰å…¨é»˜è®¤å€¼ |
| `num` | `0` | æ•°å€¼ç±»å‹çš„é€šç”¨é»˜è®¤å€¼ |

**ä¸ºä»€ä¹ˆåŸºç¡€ç±»å‹åº”è¯¥éç©ºï¼Ÿ**

```dart
// âœ… æ¨èåšæ³•ï¼šåˆ©ç”¨å†…ç½®é»˜è®¤å€¼æœºåˆ¶
class Product {
  final String name;        // æ°¸è¿œä¸ä¼šæ˜¯ nullï¼Œæœ€å·®æƒ…å†µæ˜¯ç©ºå­—ç¬¦ä¸²
  final double price;       // æ°¸è¿œä¸ä¼šæ˜¯ nullï¼Œæœ€å·®æƒ…å†µæ˜¯ 0.0
  final bool available;     // æ°¸è¿œä¸ä¼šæ˜¯ nullï¼Œæœ€å·®æƒ…å†µæ˜¯ false

  Product({
    required this.name,
    required this.price,
    required this.available,
  });

  factory Product.fromJson(Map<String, dynamic> json) {
    return Product(
      name: json.asString('name'),        // è‡ªåŠ¨å¤„ç† null -> ''
      price: json.asDouble('price'),      // è‡ªåŠ¨å¤„ç† null -> 0.0
      available: json.asBool('available'), // è‡ªåŠ¨å¤„ç† null -> false
    );
  }
}

// âŒ ä¸å¿…è¦çš„å¤æ‚æ€§
class ProductBad {
  final String? name;       // å¢åŠ äº†ä¸å¿…è¦çš„ null æ£€æŸ¥è´Ÿæ‹…
  final double? price;      // éœ€è¦é¢å¤–çš„ null å¤„ç†é€»è¾‘
  final bool? available;    // ä½¿ç”¨æ—¶éœ€è¦ ?? æ“ä½œç¬¦
}
```

### ğŸ” è§„åˆ™ 4 æ·±åº¦è§£æï¼šå‡½æ•°å¼•ç”¨ vs Lambda è¡¨è¾¾å¼

**å‡½æ•°å¼•ç”¨çš„ä¼˜åŠ¿ï¼š**

1. **æ€§èƒ½ä¼˜åŒ–**ï¼šé¿å…äº†é¢å¤–çš„å‡½æ•°è°ƒç”¨å¼€é”€
2. **ä»£ç ç®€æ´**ï¼šå‡å°‘äº†æ ·æ¿ä»£ç 
3. **ç±»å‹æ¨å¯¼**ï¼šæ›´å¥½çš„ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥
4. **å†…å­˜æ•ˆç‡**ï¼šå‡½æ•°å¼•ç”¨æ˜¯ç¼–è¯‘æ—¶å¸¸é‡

```dart
// âœ… å‡½æ•°å¼•ç”¨ï¼šç¼–è¯‘æ—¶ä¼˜åŒ–ï¼Œé›¶å¼€é”€æŠ½è±¡
final user = json.asBean<User>('user', User.fromJson);
final users = json.asList<User>('users', User.fromJson);

// âŒ Lambda è¡¨è¾¾å¼ï¼šè¿è¡Œæ—¶åˆ›å»ºé—­åŒ…ï¼Œé¢å¤–å¼€é”€
final user = json.asBean<User>('user', (json) => User.fromJson(json));
final users = json.asList<User>('users', (json) => User.fromJson(json));
```

**é€‚ç”¨åœºæ™¯å¯¹æ¯”ï¼š**

```dart
// âœ… æ ‡å‡†åœºæ™¯ï¼šç›´æ¥ä½¿ç”¨æ„é€ å‡½æ•°å¼•ç”¨
final articles = json.asList<Article>('articles', Article.fromJson);

// âœ… éœ€è¦é¢å¤–å¤„ç†æ—¶ï¼šä½¿ç”¨ lambda è¡¨è¾¾å¼
final articles = json.asList<Article>('articles', (json) {
  // æ·»åŠ é¢å¤–çš„éªŒè¯æˆ–å¤„ç†é€»è¾‘
  if (json.asString('status') == 'deleted') {
    return null; // è¿‡æ»¤å·²åˆ é™¤çš„æ–‡ç« 
  }
  return Article.fromJson(json);
});

// âœ… å¤æ‚æ˜ å°„åœºæ™¯ï¼šä½¿ç”¨ lambda è¡¨è¾¾å¼
final processedData = json.asList<ProcessedItem>('items', (json) {
  final item = RawItem.fromJson(json);
  return ProcessedItem.fromRawItem(item); // éœ€è¦é¢å¤–è½¬æ¢æ­¥éª¤
});
```

### ğŸ’¡ æœ€ä½³å®è·µç»¼åˆç¤ºä¾‹

```dart
class CompleteExample {
  // åŸºç¡€ç±»å‹ï¼šéç©ºå£°æ˜ï¼ˆè§„åˆ™3ï¼‰
  final String title;
  final int viewCount;
  final bool published;
  final double rating;

  // å¤æ‚ç±»å‹ï¼šå¯ç©ºå£°æ˜
  final User? author;
  final List<Comment>? comments;
  final Map<String, dynamic>? metadata;

  CompleteExample({
    required this.title,
    required this.viewCount,
    required this.published,
    required this.rating,
    this.author,
    this.comments,
    this.metadata,
  });

  factory CompleteExample.fromJson(Map<String, dynamic> json) {
    return CompleteExample(
      // åŸºç¡€ç±»å‹è‡ªåŠ¨è·å¾—é»˜è®¤å€¼ï¼ˆè§„åˆ™3ï¼‰
      title: json.asString('title'),
      viewCount: json.asInt('view_count'),
      published: json.asBool('published'),
      rating: json.asDouble('rating'),

      // ä½¿ç”¨æ„é€ å‡½æ•°å¼•ç”¨ï¼ˆè§„åˆ™4ï¼‰
      author: json.asBean<User>('author', User.fromJson),
      comments: json.asList<Comment>('comments', Comment.fromJson),

      // ç›´æ¥èµ‹å€¼å¤æ‚ç±»å‹
      metadata: json['metadata'] as Map<String, dynamic>?,
    );
  }

  Map<String, dynamic> toJson() {
    // ä½¿ç”¨æ¡ä»¶è¯­æ³•ï¼ˆè§„åˆ™2ï¼‰
    return {
      'title': title,
      'view_count': viewCount,
      'published': published,
      'rating': rating,
      if (author != null) 'author': author!.toJson(),
      if (comments?.isNotEmpty == true) 'comments': comments!.map((c) => c.toJson()).toList(),
      if (metadata?.isNotEmpty == true) 'metadata': metadata,
    };
  }
}
```

---

## é¡¹ç›®æ¦‚è¿°

**json2dart_safe** æ˜¯ä¸€ä¸ªä¸“ä¸º Flutter/Dart è®¾è®¡çš„ JSON å®‰å…¨è§£æåº“ï¼Œæä¾›ç©ºå®‰å…¨ç‰¹æ€§å’Œé»˜è®¤å€¼å¤„ç†ã€‚è¯¥æ’ä»¶æ—¨åœ¨è§£å†³ JSON æ•°æ®è§£æè¿‡ç¨‹ä¸­å¸¸è§çš„ç±»å‹ä¸åŒ¹é…ã€ç©ºå€¼å¤„ç†ç­‰é—®é¢˜ï¼Œç¡®ä¿åº”ç”¨ç¨‹åºçš„ç¨³å®šæ€§ã€‚

## æ ¸å¿ƒæ¨¡å—

### 1. Json2Dart å•ä¾‹ç®¡ç†å™¨

**ä½ç½®**: `lib/src/json2dart.dart`

**åŠŸèƒ½**: æä¾›å…¨å±€é”™è¯¯å›è°ƒç®¡ç†

```dart
class Json2Dart {
  static Json2Dart get instance => _getInstance();

  // æ·»åŠ ç®€å•é”™è¯¯å›è°ƒ
  void addCallback(Function(String) callBack);

  // æ·»åŠ è¯¦ç»†é”™è¯¯å›è°ƒï¼ˆåŒ…å«æ–¹æ³•åã€é”®åã€åŸå§‹æ•°æ®ï¼‰
  void addDetailCallback(Function(String method, String key, Map? map) callBack);
}
```

**ä½¿ç”¨ç¤ºä¾‹**:
```dart
Json2Dart.instance.addCallback((error) {
  print('JSONè§£æé”™è¯¯: $error');
});

Json2Dart.instance.addDetailCallback((method, key, map) {
  print('æ–¹æ³•: $method, é”®: $key, æ•°æ®: $map');
});
```

### 2. JsonFormatter æ ¼å¼åŒ–å·¥å…·

**ä½ç½®**: `lib/src/json_formatter.dart`

**åŠŸèƒ½**: æä¾› JSON æ•°æ®çš„æ ¼å¼åŒ–è¾“å‡º

```dart
class JsonFormatter {
  static String format(
    dynamic data, {
    int deep = 0,
    String indentation = '  ',
    String key = '',
  });
}
```

**ç‰¹æ€§**:
- æ”¯æŒåµŒå¥—å¯¹è±¡å’Œæ•°ç»„çš„æ ¼å¼åŒ–
- å¯è‡ªå®šä¹‰ç¼©è¿›å­—ç¬¦å’Œå±‚çº§
- è‡ªåŠ¨å¤„ç†ä¸åŒæ•°æ®ç±»å‹çš„æ ¼å¼åŒ–

**ä½¿ç”¨ç¤ºä¾‹**:
```dart
var jsonData = {'name': 'Flutter', 'version': '3.0'};
String formatted = JsonFormatter.format(jsonData);
print(formatted);
```

### 3. æ ¸å¿ƒæ‰©å±•æ–¹æ³• (MapExt)

**ä½ç½®**: `lib/src/json_parse_utils.dart`

è¿™æ˜¯åº“çš„æ ¸å¿ƒï¼Œä¸º `Map?` ç±»å‹æä¾›äº†ä¸°å¯Œçš„å®‰å…¨è§£ææ‰©å±•æ–¹æ³•ã€‚

## æ•°æ®ç±»å‹è§£ææ–¹æ³•

### å­—ç¬¦ä¸²è§£æ

```dart
// å•å­—æ®µè§£æ
String asString(String key, [String? defValue]);

// å¤šå­—æ®µè§£æï¼ˆä»…å½“ç”¨æˆ·æ˜ç¡®è¦æ±‚æ—¶ä½¿ç”¨ï¼‰
String asStrings(List<String> keys, [String? defValue]);
```

**ä½¿ç”¨ç¤ºä¾‹**:
```dart
Map<String, dynamic> json = {'name': 'Flutter', 'title': null};

// åŸºç¡€ç±»å‹ä½¿ç”¨éç©ºå£°æ˜ï¼ˆéµå¾ªè§„åˆ™3ï¼‰
String name = json.asString('name');        // 'Flutter'
String title = json.asString('title');      // '' (ç©ºå­—ç¬¦ä¸²é»˜è®¤å€¼)

// åªæœ‰åœ¨ç”¨æˆ·æ˜ç¡®è¦æ±‚æ—¶æ‰æ·»åŠ è‡ªå®šä¹‰é»˜è®¤å€¼ï¼ˆéµå¾ªè§„åˆ™1ï¼‰
String nameWithDefault = json.asString('name', 'é»˜è®¤åç§°');        // 'Flutter'
String titleWithDefault = json.asString('title', 'é»˜è®¤æ ‡é¢˜');      // 'é»˜è®¤æ ‡é¢˜'

// åªæœ‰åœ¨ç”¨æˆ·æ˜ç¡®è¦æ±‚å¤šå­—æ®µè§£ææ—¶æ‰ä½¿ç”¨ï¼ˆéµå¾ªè§„åˆ™5ï¼‰
// ä¾‹å¦‚ï¼šç”¨æˆ·è¯´"ä»titleæˆ–nameå­—æ®µä¸­è·å–æ˜¾ç¤ºæ–‡æœ¬"
String displayText = json.asStrings(['title', 'name'], 'æ— ');     // 'Flutter'
```

### æ•°å€¼è§£æ

```dart
// æ•´æ•°è§£æ
int asInt(String key, [int? defValue]);
int asInts(List<String> keys, [int? defValue]);  // ä»…å½“ç”¨æˆ·æ˜ç¡®è¦æ±‚æ—¶ä½¿ç”¨

// æµ®ç‚¹æ•°è§£æ
double asDouble(String key, [double? defValue]);
double asDoubles(List<String> keys, [double? defValue]);  // ä»…å½“ç”¨æˆ·æ˜ç¡®è¦æ±‚æ—¶ä½¿ç”¨

// æ•°å€¼è§£æï¼ˆè‡ªåŠ¨åˆ¤æ–­ int/doubleï¼‰
num asNum(String key);
```

**ä½¿ç”¨ç¤ºä¾‹**:
```dart
Map<String, dynamic> json = {
  'age': '25',
  'price': '99.99',
  'count': null
};

// åŸºç¡€ç±»å‹ä½¿ç”¨éç©ºå£°æ˜ï¼ˆéµå¾ªè§„åˆ™3ï¼‰
int age = json.asInt('age');           // 25
double price = json.asDouble('price'); // 99.99
int count = json.asInt('count');       // 0 (é»˜è®¤å€¼)

// åªæœ‰åœ¨ç”¨æˆ·æ˜ç¡®è¦æ±‚æ—¶æ‰æ·»åŠ è‡ªå®šä¹‰é»˜è®¤å€¼ï¼ˆéµå¾ªè§„åˆ™1ï¼‰
int countWithDefault = json.asInt('count', 1);       // 1 (æ˜ç¡®è¦æ±‚çš„é»˜è®¤å€¼)
```

### å¸ƒå°”å€¼è§£æ

```dart
// å•å­—æ®µå¸ƒå°”è§£æ
bool asBool(String key, [bool? defValue]);

// å¤šå­—æ®µå¸ƒå°”è§£æï¼ˆä»…å½“ç”¨æˆ·æ˜ç¡®è¦æ±‚æ—¶ä½¿ç”¨ï¼‰
bool asBools(List<String> keys, [bool? defValue]);
```

**æ™ºèƒ½è½¬æ¢è§„åˆ™**:
- `true`, `'true'`, `1`, `'1'` â†’ `true`
- `false`, `'false'`, `0`, `'0'` â†’ `false`
- `null` æˆ–å…¶ä»–å€¼ â†’ ä½¿ç”¨é»˜è®¤å€¼

**ä½¿ç”¨ç¤ºä¾‹**:
```dart
Map<String, dynamic> json = {
  'isActive': 'true',
  'isVisible': 1,
  'isEnabled': false,
  'isHidden': null
};

// åŸºç¡€ç±»å‹ä½¿ç”¨éç©ºå£°æ˜ï¼ˆéµå¾ªè§„åˆ™3ï¼‰
bool active = json.asBool('isActive');    // true
bool visible = json.asBool('isVisible');  // true
bool enabled = json.asBool('isEnabled');  // false
bool hidden = json.asBool('isHidden');    // false (é»˜è®¤å€¼)

// åªæœ‰åœ¨ç”¨æˆ·æ˜ç¡®è¦æ±‚æ—¶æ‰æ·»åŠ è‡ªå®šä¹‰é»˜è®¤å€¼ï¼ˆéµå¾ªè§„åˆ™1ï¼‰
bool activeWithDefault = json.asBool('isActive', true);   // true
```

## å¤æ‚æ•°æ®ç»“æ„è§£æ

### åˆ—è¡¨è§£æ

```dart
// åŸºç¡€åˆ—è¡¨è§£æ
List<T>? asList<T>(String key, [Function(Map json)? toBean]);

// å¤šå­—æ®µåˆ—è¡¨è§£æï¼ˆä»…å½“ç”¨æˆ·æ˜ç¡®è¦æ±‚æ—¶ä½¿ç”¨ï¼‰
List<T>? asLists<T>(List<String> keys, [Function(Map json)? toBean]);

// äºŒç»´æ•°ç»„è§£æ
List<List<T>>? asArray2d<T>(String key, [Function(Map json)? toBean]);
```

**ä½¿ç”¨ç¤ºä¾‹**:
```dart
// åŸºç¡€ç±»å‹åˆ—è¡¨
Map<String, dynamic> json = {
  'numbers': [1, 2, 3],
  'names': ['A', 'B', 'C']
};

List<int>? numbers = json.asList<int>('numbers');
List<String>? names = json.asList<String>('names');

// å¯¹è±¡åˆ—è¡¨ï¼ˆéµå¾ªè§„åˆ™4ï¼šä½¿ç”¨æ„é€ å‡½æ•°å¼•ç”¨ï¼‰
Map<String, dynamic> jsonWithObjects = {
  'users': [
    {'name': 'Alice', 'age': 25},
    {'name': 'Bob', 'age': 30}
  ]
};

List<User>? users = jsonWithObjects.asList<User>('users', User.fromJson);
```

### è‡ªå®šä¹‰æ¨¡å‹è§£æ

```dart
// å•ä¸ªæ¨¡å‹è§£æ
T? asBean<T>(String key, Function(Map json) toBean);

// å¤šå­—æ®µæ¨¡å‹è§£æï¼ˆä»…å½“ç”¨æˆ·æ˜ç¡®è¦æ±‚æ—¶ä½¿ç”¨ï¼‰
T? asBeans<T>(List<String> keys, Function(Map json) toBean);
```

**ä½¿ç”¨ç¤ºä¾‹**:
```dart
class User {
  final String name;    // éç©ºç±»å‹ï¼ˆéµå¾ªè§„åˆ™3ï¼‰
  final int age;        // éç©ºç±»å‹ï¼ˆéµå¾ªè§„åˆ™3ï¼‰

  const User({required this.name, required this.age});

  // å¿…é¡»æ–¹æ³•ï¼šfromJsonï¼ˆéµå¾ªè§„åˆ™6ï¼‰
  factory User.fromJson(Map<String, dynamic> json) {
    return User(
      name: json.asString('name'),     // åŸºç¡€ç±»å‹ä¸éœ€è¦é»˜è®¤å€¼
      age: json.asInt('age'),          // åŸºç¡€ç±»å‹ä¸éœ€è¦é»˜è®¤å€¼
    );
  }

  // å¿…é¡»æ–¹æ³•ï¼štoJsonï¼ˆéµå¾ªè§„åˆ™6ï¼‰
  Map<String, dynamic> toJson() {
    return {
      'name': name,
      'age': age,
    };
  }

  // å¿…é¡»æ–¹æ³•ï¼šcopyWithï¼ˆéµå¾ªè§„åˆ™6ï¼‰
  User copyWith({String? name, int? age}) {
    return User(
      name: name ?? this.name,
      age: age ?? this.age,
    );
  }
}

Map<String, dynamic> json = {
  'user': {'name': 'Alice', 'age': 25}
};

// ä½¿ç”¨æ„é€ å‡½æ•°å¼•ç”¨ï¼ˆéµå¾ªè§„åˆ™4ï¼‰
User? user = json.asBean<User>('user', User.fromJson);
```

## å·¥å…·æ–¹æ³•

### Map æ“ä½œæ–¹æ³•

```dart
// å®‰å…¨æ·»åŠ é”®å€¼å¯¹
Map put(String key, Object? value);

// ç§»é™¤ null å€¼
void removeNull();

// ç§»é™¤ null æˆ–ç©ºå­—ç¬¦ä¸²
void removeNullOrEmpty();
```

**ä½¿ç”¨ç¤ºä¾‹**:
```dart
Map<String, dynamic> data = {'name': 'Flutter', 'version': null, 'desc': ''};

data.removeNull();        // ç§»é™¤ version
data.removeNullOrEmpty(); // ç§»é™¤ version å’Œ desc
data.put('type', 'framework'); // å®‰å…¨æ·»åŠ 
```

## é”™è¯¯å¤„ç†æœºåˆ¶

### å…¨å±€é”™è¯¯ç›‘å¬

```dart
// è®¾ç½®å…¨å±€é”™è¯¯å›è°ƒ
Json2Dart.instance.addCallback((error) {
  // å¤„ç†è§£æé”™è¯¯
  print('è§£æé”™è¯¯: $error');
});

// è®¾ç½®è¯¦ç»†é”™è¯¯å›è°ƒ
Json2Dart.instance.addDetailCallback((method, key, map) {
  // è®°å½•è¯¦ç»†é”™è¯¯ä¿¡æ¯
  print('æ–¹æ³•: $method, é”®: $key');
  print('åŸå§‹æ•°æ®: $map');
});
```

### å®¹é”™æœºåˆ¶

æ‰€æœ‰è§£ææ–¹æ³•éƒ½å…·å¤‡ä»¥ä¸‹å®¹é”™ç‰¹æ€§ï¼š

1. **ç±»å‹è‡ªåŠ¨è½¬æ¢**: å­—ç¬¦ä¸²æ•°å­—è‡ªåŠ¨è½¬æ¢ä¸ºå¯¹åº”ç±»å‹
2. **é»˜è®¤å€¼å¤„ç†**: null æˆ–è§£æå¤±è´¥æ—¶è¿”å›æŒ‡å®šé»˜è®¤å€¼
3. **å¼‚å¸¸æ•è·**: å†…éƒ¨å¼‚å¸¸ä¸ä¼šå¯¼è‡´åº”ç”¨å´©æºƒ
4. **é”™è¯¯å›è°ƒ**: è§£æé”™è¯¯ä¼šè§¦å‘å…¨å±€å›è°ƒé€šçŸ¥

## é‡è¦ç¼–ç è§„åˆ™è¯¦è§£

### âš ï¸ å…³é”®è§„åˆ™ 1ï¼šé»˜è®¤å€¼ä½¿ç”¨åŸåˆ™

**åªæœ‰å½“ç”¨æˆ·æ˜ç¡®æŒ‡å‡ºè¦æ·»åŠ é»˜è®¤å€¼æ—¶ï¼Œæ‰éœ€è¦æ·»åŠ é»˜è®¤å€¼ã€‚å¦‚æœæ²¡æœ‰ç‰¹åˆ«è¯´æ˜ï¼Œé»˜è®¤æ˜¯ä¸åŠ é»˜è®¤å€¼çš„ã€‚**

```dart
// âŒ é”™è¯¯ï¼šè‡ªåŠ¨æ·»åŠ é»˜è®¤å€¼
factory User.fromJson(Map<String, dynamic> json) {
  return User(
    name: json.asString('name', 'æœªçŸ¥ç”¨æˆ·'),    // ä¸åº”è¯¥è‡ªåŠ¨æ·»åŠ é»˜è®¤å€¼
    age: json.asInt('age', 0),               // ä¸åº”è¯¥è‡ªåŠ¨æ·»åŠ é»˜è®¤å€¼
  );
}

// âœ… æ­£ç¡®ï¼šåªåœ¨å¿…è¦æ—¶ä½¿ç”¨é»˜è®¤å€¼
factory User.fromJson(Map<String, dynamic> json) {
  return User(
    name: json.asString('name'),    // ä¸æ·»åŠ é»˜è®¤å€¼
    age: json.asInt('age'),         // ä¸æ·»åŠ é»˜è®¤å€¼
  );
}

// âœ… æ­£ç¡®ï¼šç”¨æˆ·æ˜ç¡®è¦æ±‚é»˜è®¤å€¼æ—¶
factory User.fromJson(Map<String, dynamic> json) {
  return User(
    // ç”¨æˆ·æ˜ç¡®è¯´ï¼š"å¦‚æœæ²¡æœ‰nameå­—æ®µï¼Œä½¿ç”¨'åŒ¿åç”¨æˆ·'ä½œä¸ºé»˜è®¤å€¼"
    name: json.asString('name', 'åŒ¿åç”¨æˆ·'),
    age: json.asInt('age'),
  );
}
```

### âš ï¸ å…³é”®è§„åˆ™ 2ï¼šæ¡ä»¶æ€§ Map å­—æ®µæ·»åŠ 

**ç¦æ­¢ä½¿ç”¨å…ˆåˆ›å»º Map å†å•ç‹¬æ·»åŠ å­—æ®µçš„æ–¹å¼ï¼Œåº”è¯¥ç›´æ¥åœ¨ Map å­—é¢é‡ä¸­ä½¿ç”¨æ¡ä»¶è¯­æ³•ã€‚**

```dart
// âŒ é”™è¯¯å†™æ³•ï¼šå…ˆåˆ›å»º Map å†æ¡ä»¶æ·»åŠ 
final data = {
  'success': success,
  'message': message,
};
if (token != null) {
  data['token'] = token!;
}

// âœ… æ­£ç¡®å†™æ³•ï¼šç›´æ¥åœ¨ Map å­—é¢é‡ä¸­ä½¿ç”¨æ¡ä»¶è¯­æ³•
final data = {
  'success': success,
  'message': message,
  if (token != null) 'token': token,
};
```

**æ›´å¤šæ¡ä»¶è¯­æ³•ç¤ºä¾‹ï¼š**

```dart
// å¤šä¸ªæ¡ä»¶å­—æ®µ
final requestData = {
  'userId': userId,
  'action': action,
  if (params != null) 'params': params,
  if (timestamp != null) 'timestamp': timestamp,
  if (signature != null) 'signature': signature,
};

// å¤æ‚æ¡ä»¶
final userProfile = {
  'name': name,
  'email': email,
  if (age != null && age! > 0) 'age': age,
  if (avatar?.isNotEmpty == true) 'avatar': avatar,
  if (preferences?.isNotEmpty == true) 'preferences': preferences,
};

// List ä¸­çš„æ¡ä»¶å…ƒç´ 
final menuItems = [
  'home',
  'profile',
  if (isAdmin) 'admin',
  if (hasPermission('settings')) 'settings',
];
```

### ğŸ” è§„åˆ™ 5 æ·±åº¦è§£æï¼šå¤šå­—æ®µè§£æçš„ä½¿ç”¨æ—¶æœº

**ä½•æ—¶ä½¿ç”¨å¤šå­—æ®µè§£æï¼Ÿ**

å¤šå­—æ®µè§£ææ–¹æ³•ï¼ˆ`asStrings`ã€`asInts`ã€`asBools`ç­‰ï¼‰åº”è¯¥ä»…åœ¨ä»¥ä¸‹æ˜ç¡®çš„ä¸šåŠ¡åœºæ™¯ä¸­ä½¿ç”¨ï¼š

1. **API ç‰ˆæœ¬å…¼å®¹æ€§**ï¼šä¸åŒç‰ˆæœ¬ä½¿ç”¨ä¸åŒå­—æ®µå
2. **å¤šæ•°æ®æºåˆå¹¶**ï¼šå¤šä¸ªå­—æ®µå¯èƒ½åŒ…å«ç›¸åŒå«ä¹‰çš„æ•°æ®
3. **å­—æ®µåå†å²å˜æ›´**ï¼šæ—§å­—æ®µååˆ°æ–°å­—æ®µåçš„è¿‡æ¸¡æœŸ

```dart
// âœ… æ­£ç¡®åœºæ™¯1ï¼šAPIç‰ˆæœ¬å…¼å®¹
class ApiCompatibilityUser {
  final String userId;

  const ApiCompatibilityUser({required this.userId});

  factory ApiCompatibilityUser.fromJson(Map<String, dynamic> json) {
    return ApiCompatibilityUser(
      // v1 API ä½¿ç”¨ 'user_id'ï¼Œv2 API ä½¿ç”¨ 'id'ï¼Œv3 API ä½¿ç”¨ 'userId'
      userId: json.asStrings(['userId', 'id', 'user_id']),
    );
  }

  Map<String, dynamic> toJson() {
    return {'userId': userId};
  }

  ApiCompatibilityUser copyWith({String? userId}) {
    return ApiCompatibilityUser(userId: userId ?? this.userId);
  }
}

// âœ… æ­£ç¡®åœºæ™¯2ï¼šå¤šæ•°æ®æº
class ProductSearch {
  final String productName;

  const ProductSearch({required this.productName});

  factory ProductSearch.fromJson(Map<String, dynamic> json) {
    return ProductSearch(
      // å•†å“åå¯èƒ½æ¥è‡ª titleã€nameã€product_name ç­‰ä¸åŒå­—æ®µ
      productName: json.asStrings(['title', 'name', 'product_name']),
    );
  }

  Map<String, dynamic> toJson() {
    return {'productName': productName};
  }

  ProductSearch copyWith({String? productName}) {
    return ProductSearch(productName: productName ?? this.productName);
  }
}

// âŒ é”™è¯¯åœºæ™¯ï¼šæ²¡æœ‰æ˜ç¡®çš„ä¸šåŠ¡éœ€æ±‚å°±ä½¿ç”¨å¤šå­—æ®µè§£æ
class SimpleUser {
  final String name;

  const SimpleUser({required this.name});

  factory SimpleUser.fromJson(Map<String, dynamic> json) {
    return SimpleUser(
      // æ²¡æœ‰ä¸šåŠ¡éœ€æ±‚ï¼Œä¸åº”è¯¥ä½¿ç”¨å¤šå­—æ®µè§£æ
      name: json.asString('name'),  // è€Œä¸æ˜¯ json.asStrings(['name'])
    );
  }

  Map<String, dynamic> toJson() {
    return {'name': name};
  }

  SimpleUser copyWith({String? name}) {
    return SimpleUser(name: name ?? this.name);
  }
}

// âœ… é»˜è®¤æ ‡å‡†åšæ³•ï¼šå•å­—æ®µè§£æ
class StandardUser {
  final String name;
  final int age;
  final bool isActive;

  const StandardUser({
    required this.name,
    required this.age,
    required this.isActive,
  });

  factory StandardUser.fromJson(Map<String, dynamic> json) {
    return StandardUser(
      name: json.asString('name'),        // å•å­—æ®µè§£æ
      age: json.asInt('age'),            // å•å­—æ®µè§£æ
      isActive: json.asBool('isActive'), // å•å­—æ®µè§£æ
    );
  }

  Map<String, dynamic> toJson() {
    return {
      'name': name,
      'age': age,
      'isActive': isActive,
    };
  }

  StandardUser copyWith({String? name, int? age, bool? isActive}) {
    return StandardUser(
      name: name ?? this.name,
      age: age ?? this.age,
      isActive: isActive ?? this.isActive,
    );
  }
}
```

**å¤šå­—æ®µè§£æçš„ä¼˜å…ˆçº§åŸåˆ™ï¼š**

å¤šå­—æ®µè§£ææŒ‰æ•°ç»„é¡ºåºä¾æ¬¡å°è¯•ï¼Œè¿”å›ç¬¬ä¸€ä¸ªéç©ºå€¼ï¼š

```dart
// ä¼˜å…ˆçº§ï¼šusername > name > displayName > é»˜è®¤å€¼
final name = json.asStrings(['username', 'name', 'displayName'], 'Anonymous');

// å®é™…è§£æé€»è¾‘ï¼š
// 1. å…ˆå°è¯• usernameï¼Œå¦‚æœæœ‰å€¼ä¸”éç©ºï¼Œè¿”å› username
// 2. å†å°è¯• nameï¼Œå¦‚æœæœ‰å€¼ä¸”éç©ºï¼Œè¿”å› name
// 3. æœ€åå°è¯• displayNameï¼Œå¦‚æœæœ‰å€¼ä¸”éç©ºï¼Œè¿”å› displayName
// 4. éƒ½æ²¡æœ‰å€¼æ—¶ï¼Œè¿”å›é»˜è®¤å€¼ 'Anonymous'
```

### ğŸ” è§„åˆ™ 6 æ·±åº¦è§£æï¼šæ¨¡å‹ç±»å¿…å¤‡æ–¹æ³•

**ä¸ºä»€ä¹ˆæ¨¡å‹ç±»éœ€è¦è¿™ä¸‰ä¸ªæ–¹æ³•ï¼Ÿ**

1. **fromJson**ï¼šJSON æ•°æ®ååºåˆ—åŒ–ï¼Œå°† Map è½¬æ¢ä¸º Dart å¯¹è±¡
2. **toJson**ï¼šJSON æ•°æ®åºåˆ—åŒ–ï¼Œå°† Dart å¯¹è±¡è½¬æ¢ä¸º Map
3. **copyWith**ï¼šä¸å¯å˜å¯¹è±¡æ›´æ–°ï¼Œåˆ›å»ºå±æ€§éƒ¨åˆ†ä¿®æ”¹çš„æ–°å®ä¾‹

**å®Œæ•´çš„æ¨¡å‹ç±»æ¨¡æ¿ï¼š**

```dart
class User {
  final String name;
  final int age;
  final bool isActive;
  final UserProfile? profile;
  final List<String>? tags;

  const User({
    required this.name,
    required this.age,
    required this.isActive,
    this.profile,
    this.tags,
  });

  // å¿…é¡»æ–¹æ³•1ï¼šfromJson - JSON ååºåˆ—åŒ–
  factory User.fromJson(Map<String, dynamic> json) {
    return User(
      name: json.asString('name'),
      age: json.asInt('age'),
      isActive: json.asBool('isActive'),
      profile: json.asBean<UserProfile>('profile', UserProfile.fromJson),
      tags: json.asList<String>('tags'),
    );
  }

  // å¿…é¡»æ–¹æ³•2ï¼štoJson - JSON åºåˆ—åŒ–
  Map<String, dynamic> toJson() {
    return {
      'name': name,
      'age': age,
      'isActive': isActive,
      if (profile != null) 'profile': profile!.toJson(),
      if (tags?.isNotEmpty == true) 'tags': tags,
    };
  }

  // å¿…é¡»æ–¹æ³•3ï¼šcopyWith - ä¸å¯å˜å¯¹è±¡æ›´æ–°
  User copyWith({
    String? name,
    int? age,
    bool? isActive,
    UserProfile? profile,
    List<String>? tags,
  }) {
    return User(
      name: name ?? this.name,
      age: age ?? this.age,
      isActive: isActive ?? this.isActive,
      profile: profile ?? this.profile,
      tags: tags ?? this.tags,
    );
  }

  // å¯é€‰ï¼šé‡å†™ toString, hashCode, == ç­‰æ–¹æ³•
  @override
  String toString() {
    return 'User(name: $name, age: $age, isActive: $isActive, profile: $profile, tags: $tags)';
  }

  @override
  bool operator ==(Object other) {
    if (identical(this, other)) return true;
    return other is User &&
        other.name == name &&
        other.age == age &&
        other.isActive == isActive &&
        other.profile == profile &&
        listEquals(other.tags, tags);
  }

  @override
  int get hashCode => Object.hash(name, age, isActive, profile, tags);
}
```

**copyWith æ–¹æ³•çš„é«˜çº§ç”¨æ³•ï¼š**

```dart
// åŸºç¡€ç”¨æ³•ï¼šæ›´æ–°å•ä¸ªå±æ€§
final user = User(name: 'Alice', age: 25, isActive: true);
final updatedUser = user.copyWith(age: 26);

// å¤æ‚ç”¨æ³•ï¼šæ¡ä»¶æ€§æ›´æ–°
final userWithUpdatedProfile = user.copyWith(
  profile: user.profile?.copyWith(avatar: newAvatar) ??
           UserProfile(avatar: newAvatar),
);

// æ‰¹é‡æ›´æ–°
final fullyUpdatedUser = user.copyWith(
  name: 'Alice Smith',
  age: 26,
  isActive: false,
  tags: ['flutter', 'developer'],
);

// æ¸…ç©ºå¯é€‰å­—æ®µï¼ˆä¼ å…¥ nullï¼‰
final userWithoutTags = user.copyWith(tags: null);
```

**ä¸åŒç±»å‹å­—æ®µçš„ copyWith å¤„ç†ï¼š**

```dart
class ComplexModel {
  final String title;
  final List<String>? items;
  final Map<String, dynamic>? metadata;
  final CustomObject? customObj;

  // copyWith éœ€è¦æ­£ç¡®å¤„ç†ä¸åŒç±»å‹
  ComplexModel copyWith({
    String? title,
    List<String>? items,          // å¯é€‰åˆ—è¡¨
    Map<String, dynamic>? metadata, // å¯é€‰ Map
    CustomObject? customObj,       // å¯é€‰è‡ªå®šä¹‰å¯¹è±¡
  }) {
    return ComplexModel(
      title: title ?? this.title,
      items: items ?? this.items,
      metadata: metadata ?? this.metadata,
      customObj: customObj ?? this.customObj,
    );
  }
}
```

**ç‰¹æ®Šåœºæ™¯çš„å¤„ç†ï¼š**

```dart
// 1. éœ€è¦æ˜ç¡®åŒºåˆ† null å’Œä¸æ›´æ–°çš„åœºæ™¯
class AdvancedModel {
  final String? optionalField;

  // ä½¿ç”¨åŒ…è£…ç±»æ¥åŒºåˆ† null å’Œä¸æ›´æ–°
  AdvancedModel copyWith({
    String? optionalField,
    bool updateOptionalField = false,
  }) {
    return AdvancedModel(
      optionalField: updateOptionalField ? optionalField : this.optionalField,
    );
  }
}

// 2. ä½¿ç”¨freezedåŒ…å¯ä»¥è‡ªåŠ¨ç”Ÿæˆè¿™äº›æ–¹æ³•
@freezed
class AutoGeneratedModel with _$AutoGeneratedModel {
  const factory AutoGeneratedModel({
    required String name,
    required int age,
    bool? isActive,
  }) = _AutoGeneratedModel;

  factory AutoGeneratedModel.fromJson(Map<String, dynamic> json) =>
      _$AutoGeneratedModelFromJson(json);
}
```

## æœ€ä½³å®è·µ

### 1. æ¨¡å‹ç±»è®¾è®¡

```dart
class ApiResponse {
  final int code;        // éç©ºç±»å‹ï¼ˆéµå¾ªè§„åˆ™3ï¼‰
  final String message;  // éç©ºç±»å‹ï¼ˆéµå¾ªè§„åˆ™3ï¼‰
  final Data? data;      // å¤æ‚ç±»å‹å¯ç©ºï¼ˆå¯èƒ½ä¸ºnullï¼‰

  const ApiResponse({
    required this.code,
    required this.message,
    this.data,
  });

  // å¿…é¡»æ–¹æ³•ï¼šfromJsonï¼ˆéµå¾ªè§„åˆ™6ï¼‰
  factory ApiResponse.fromJson(Map<String, dynamic> json) {
    return ApiResponse(
      // åŸºç¡€ç±»å‹è‡ªåŠ¨è·å¾—é»˜è®¤å€¼ï¼ˆéµå¾ªè§„åˆ™3ï¼‰
      code: json.asInt('code'),           // è‡ªåŠ¨é»˜è®¤ä¸º 0
      message: json.asString('message'),  // è‡ªåŠ¨é»˜è®¤ä¸º ''
      // ä½¿ç”¨æ„é€ å‡½æ•°å¼•ç”¨ï¼ˆéµå¾ªè§„åˆ™4ï¼‰
      data: json.asBean<Data>('data', Data.fromJson),
    );
  }

  // å¿…é¡»æ–¹æ³•ï¼štoJsonï¼ˆéµå¾ªè§„åˆ™6ï¼‰
  // è½¬æ¢ä¸º JSON æ—¶ä½¿ç”¨æ¡ä»¶è¯­æ³•ï¼ˆéµå¾ªè§„åˆ™2ï¼‰
  Map<String, dynamic> toJson() {
    return {
      'code': code,
      'message': message,
      if (data != null) 'data': data!.toJson(),
    };
  }

  // å¿…é¡»æ–¹æ³•ï¼šcopyWithï¼ˆéµå¾ªè§„åˆ™6ï¼‰
  ApiResponse copyWith({
    int? code,
    String? message,
    Data? data,
  }) {
    return ApiResponse(
      code: code ?? this.code,
      message: message ?? this.message,
      data: data ?? this.data,
    );
  }
}
```

### 2. é”™è¯¯ç›‘æ§

```dart
void setupJsonErrorMonitoring() {
  Json2Dart.instance.addDetailCallback((method, key, map) {
    // ä½¿ç”¨æ¡ä»¶è¯­æ³•æ„å»ºé”™è¯¯æŠ¥å‘Šï¼ˆéµå¾ªè§„åˆ™2ï¼‰
    final errorReport = {
      'method': method,
      'key': key,
      if (map != null) 'data': map.toString(),
      'timestamp': DateTime.now().toIso8601String(),
    };

    // å‘é€é”™è¯¯æŠ¥å‘Šåˆ°ç›‘æ§ç³»ç»Ÿ
    ErrorReporter.report('JSONè§£æé”™è¯¯', errorReport);
  });
}
```

### 3. å…¼å®¹æ€§å¤„ç†

```dart
// å¤„ç†ä¸åŒç‰ˆæœ¬ API çš„å­—æ®µå˜åŒ–
class User {
  final String name;     // åŸºç¡€ç±»å‹ä½¿ç”¨éç©ºï¼ˆéµå¾ªè§„åˆ™3ï¼‰
  final UserProfile? profile;  // å¤æ‚ç±»å‹å¯ç©º

  const User({required this.name, this.profile});

  // å¿…é¡»æ–¹æ³•ï¼šfromJsonï¼ˆéµå¾ªè§„åˆ™6ï¼‰
  factory User.fromJson(Map<String, dynamic> json) {
    return User(
      // æ ‡å‡†åœºæ™¯ï¼šä½¿ç”¨å•å­—æ®µè§£æï¼ˆéµå¾ªè§„åˆ™5ï¼‰
      name: json.asString('name'),
      // ä½¿ç”¨æ„é€ å‡½æ•°å¼•ç”¨ï¼ˆéµå¾ªè§„åˆ™4ï¼‰
      profile: json.asBean<UserProfile>('profile', UserProfile.fromJson),
    );
  }

  // å¿…é¡»æ–¹æ³•ï¼štoJsonï¼ˆéµå¾ªè§„åˆ™6ï¼‰
  // è½¬æ¢ä¸º JSON æ—¶ä½¿ç”¨æ¡ä»¶è¯­æ³•ï¼ˆéµå¾ªè§„åˆ™2ï¼‰
  Map<String, dynamic> toJson() {
    return {
      'name': name,  // åŸºç¡€ç±»å‹ç›´æ¥æ·»åŠ ï¼Œä¸éœ€è¦åˆ¤ç©º
      if (profile != null) 'profile': profile!.toJson(),
      'timestamp': DateTime.now().toIso8601String(),
    };
  }

  // å¿…é¡»æ–¹æ³•ï¼šcopyWithï¼ˆéµå¾ªè§„åˆ™6ï¼‰
  User copyWith({String? name, UserProfile? profile}) {
    return User(
      name: name ?? this.name,
      profile: profile ?? this.profile,
    );
  }
}

// ç”¨æˆ·æ˜ç¡®è¦æ±‚å¤šå­—æ®µè§£æçš„åœºæ™¯ï¼ˆéµå¾ªè§„åˆ™5ï¼‰
class UserWithMultiFieldParsing {
  final String name;

  const UserWithMultiFieldParsing({required this.name});

  // å¿…é¡»æ–¹æ³•ï¼šfromJsonï¼ˆéµå¾ªè§„åˆ™6ï¼‰
  factory UserWithMultiFieldParsing.fromJson(Map<String, dynamic> json) {
    return UserWithMultiFieldParsing(
      // ç”¨æˆ·æ˜ç¡®è¯´ï¼š"å°è¯•ä»usernameã€nameã€displayNameå­—æ®µä¸­è·å–ç”¨æˆ·å"
      name: json.asStrings(['username', 'name', 'displayName']),
    );
  }

  // å¿…é¡»æ–¹æ³•ï¼štoJsonï¼ˆéµå¾ªè§„åˆ™6ï¼‰
  Map<String, dynamic> toJson() {
    return {'name': name};
  }

  // å¿…é¡»æ–¹æ³•ï¼šcopyWithï¼ˆéµå¾ªè§„åˆ™6ï¼‰
  UserWithMultiFieldParsing copyWith({String? name}) {
    return UserWithMultiFieldParsing(name: name ?? this.name);
  }
}

// ç”¨æˆ·æ˜ç¡®è¦æ±‚è‡ªå®šä¹‰é»˜è®¤å€¼çš„åœºæ™¯ï¼ˆéµå¾ªè§„åˆ™1ï¼‰
class UserWithCustomDefault {
  final String name;

  const UserWithCustomDefault({required this.name});

  // å¿…é¡»æ–¹æ³•ï¼šfromJsonï¼ˆéµå¾ªè§„åˆ™6ï¼‰
  factory UserWithCustomDefault.fromJson(Map<String, dynamic> json) {
    return UserWithCustomDefault(
      // ç”¨æˆ·æ˜ç¡®è¦æ±‚ï¼šå¦‚æœæ‰¾ä¸åˆ°ç”¨æˆ·åï¼Œä½¿ç”¨'åŒ¿åç”¨æˆ·'
      name: json.asString('name', 'åŒ¿åç”¨æˆ·'),
    );
  }

  // å¿…é¡»æ–¹æ³•ï¼štoJsonï¼ˆéµå¾ªè§„åˆ™6ï¼‰
  Map<String, dynamic> toJson() {
    return {'name': name};
  }

  // å¿…é¡»æ–¹æ³•ï¼šcopyWithï¼ˆéµå¾ªè§„åˆ™6ï¼‰
  UserWithCustomDefault copyWith({String? name}) {
    return UserWithCustomDefault(name: name ?? this.name);
  }
}
```

## æ€§èƒ½è€ƒè™‘

1. **ç±»å‹æ£€æŸ¥ä¼˜åŒ–**: ä¼˜å…ˆæ£€æŸ¥ç›®æ ‡ç±»å‹ï¼Œå‡å°‘ä¸å¿…è¦çš„è½¬æ¢
2. **ç¼“å­˜æœºåˆ¶**: å¯¹äºå¤æ‚çš„åµŒå¥—è§£æï¼Œè€ƒè™‘æ·»åŠ ç¼“å­˜å±‚
3. **æ‰¹é‡æ“ä½œ**: ä½¿ç”¨å¤šå­—æ®µè§£ææ–¹æ³•å‡å°‘é‡å¤éå†

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•å¤„ç†æ·±åº¦åµŒå¥—çš„ JSONï¼Ÿ
A: é€å±‚ä½¿ç”¨ `asBean` æ–¹æ³•ï¼Œä¸ºæ¯ä¸ªå±‚çº§åˆ›å»ºå¯¹åº”çš„æ¨¡å‹ç±»ï¼Œç¡®ä¿æ¯ä¸ªæ¨¡å‹ç±»éƒ½åŒ…å« fromJsonã€toJson å’Œ copyWith æ–¹æ³•ã€‚

### Q: å¤§é‡æ•°æ®è§£ææ€§èƒ½å¦‚ä½•ä¼˜åŒ–ï¼Ÿ
A: è€ƒè™‘ä½¿ç”¨ `asLists` çš„æ‰¹é‡è§£æåŠŸèƒ½ï¼Œé¿å…å•ä¸ªå…ƒç´ é€ä¸€è§£æã€‚

### Q: å¦‚ä½•è°ƒè¯•è§£æé”™è¯¯ï¼Ÿ
A: å¯ç”¨è¯¦ç»†é”™è¯¯å›è°ƒï¼Œè®°å½•è§£æå¤±è´¥çš„å…·ä½“ä½ç½®å’ŒåŸå› ã€‚

### Q: ä¸ºä»€ä¹ˆå¿…é¡»è¦æœ‰ fromJsonã€toJson å’Œ copyWith æ–¹æ³•ï¼Ÿ
A:
- **fromJson**: ç¡®ä¿èƒ½ä»JSONæ•°æ®åˆ›å»ºDartå¯¹è±¡ï¼Œæ”¯æŒAPIæ•°æ®ååºåˆ—åŒ–
- **toJson**: ç¡®ä¿èƒ½å°†Dartå¯¹è±¡è½¬æ¢ä¸ºJSONï¼Œæ”¯æŒæ•°æ®æŒä¹…åŒ–å’Œç½‘ç»œä¼ è¾“
- **copyWith**: æ”¯æŒä¸å¯å˜å¯¹è±¡çš„å±æ€§æ›´æ–°ï¼Œç¬¦åˆFlutteræœ€ä½³å®è·µ

### Q: copyWith æ–¹æ³•å¦‚ä½•å¤„ç†å¯é€‰å­—æ®µçš„ null å€¼ï¼Ÿ
A: ä½¿ç”¨ `??` æ“ä½œç¬¦ä¿æŒåŸå€¼ï¼Œå¦‚æœéœ€è¦æ˜ç¡®è®¾ç½®ä¸º nullï¼Œå¯ä»¥ä½¿ç”¨åŒ…è£…ç±»æˆ–é¢å¤–çš„å¸ƒå°”å‚æ•°æ¥åŒºåˆ†ã€‚

### Q: æ˜¯å¦å¯ä»¥ä½¿ç”¨ä»£ç ç”Ÿæˆå·¥å…·æ¥è‡ªåŠ¨ç”Ÿæˆè¿™äº›æ–¹æ³•ï¼Ÿ
A: æ˜¯çš„ï¼Œæ¨èä½¿ç”¨ `freezed`ã€`json_annotation` ç­‰åŒ…æ¥è‡ªåŠ¨ç”Ÿæˆè¿™äº›æ ·æ¿ä»£ç ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚

## è‡ªåŠ¨ä»£ç ç”Ÿæˆå»ºè®®

ä¸ºäº†æé«˜å¼€å‘æ•ˆç‡ï¼Œå»ºè®®ä½¿ç”¨ä»£ç ç”Ÿæˆå·¥å…·æ¥è‡ªåŠ¨ç”Ÿæˆ fromJsonã€toJson å’Œ copyWith æ–¹æ³•ï¼š

### ä½¿ç”¨ freezed åŒ…ï¼ˆæ¨èï¼‰

```yaml
# pubspec.yaml
dependencies:
  freezed_annotation: ^2.4.1
  json_annotation: ^4.8.1

dev_dependencies:
  build_runner: ^2.4.7
  freezed: ^2.4.6
  json_serializable: ^6.7.1
```

```dart
// user.dart
import 'package:freezed_annotation/freezed_annotation.dart';

part 'user.freezed.dart';
part 'user.g.dart';

@freezed
class User with _$User {
  const factory User({
    required String name,
    required int age,
    required bool isActive,
    UserProfile? profile,
    List<String>? tags,
  }) = _User;

  factory User.fromJson(Map<String, dynamic> json) => _$UserFromJson(json);
}
```

ç”Ÿæˆå‘½ä»¤ï¼š
```bash
dart run build_runner build
```

### ä½¿ç”¨ json_serializable åŒ…

```dart
import 'package:json_annotation/json_annotation.dart';

part 'user.g.dart';

@JsonSerializable()
class User {
  final String name;
  final int age;
  final bool isActive;

  const User({required this.name, required this.age, required this.isActive});

  factory User.fromJson(Map<String, dynamic> json) => _$UserFromJson(json);
  Map<String, dynamic> toJson() => _$UserToJson(this);

  // ä»éœ€æ‰‹åŠ¨å®ç° copyWith
  User copyWith({String? name, int? age, bool? isActive}) {
    return User(
      name: name ?? this.name,
      age: age ?? this.age,
      isActive: isActive ?? this.isActive,
    );
  }
}
```

### æ‰‹åŠ¨å®ç° vs è‡ªåŠ¨ç”Ÿæˆå¯¹æ¯”

| ç‰¹æ€§ | æ‰‹åŠ¨å®ç° | freezed | json_serializable |
|------|----------|---------|-------------------|
| fromJson | âœ… å®Œå…¨æ§åˆ¶ | âœ… è‡ªåŠ¨ç”Ÿæˆ | âœ… è‡ªåŠ¨ç”Ÿæˆ |
| toJson | âœ… å®Œå…¨æ§åˆ¶ | âœ… è‡ªåŠ¨ç”Ÿæˆ | âœ… è‡ªåŠ¨ç”Ÿæˆ |
| copyWith | âœ… å®Œå…¨æ§åˆ¶ | âœ… è‡ªåŠ¨ç”Ÿæˆ | âŒ éœ€æ‰‹åŠ¨å®ç° |
| ä¸å¯å˜æ€§ | âœ… æ‰‹åŠ¨ä¿è¯ | âœ… è‡ªåŠ¨ä¿è¯ | âœ… æ‰‹åŠ¨ä¿è¯ |
| equals/hashCode | âŒ éœ€æ‰‹åŠ¨å®ç° | âœ… è‡ªåŠ¨ç”Ÿæˆ | âŒ éœ€æ‰‹åŠ¨å®ç° |
| toString | âŒ éœ€æ‰‹åŠ¨å®ç° | âœ… è‡ªåŠ¨ç”Ÿæˆ | âŒ éœ€æ‰‹åŠ¨å®ç° |

**æ¨èç­–ç•¥**ï¼š
- **ç®€å•æ¨¡å‹**ï¼šæ‰‹åŠ¨å®ç°ï¼Œå®Œå…¨æ§åˆ¶
- **å¤æ‚æ¨¡å‹**ï¼šä½¿ç”¨ freezedï¼Œå‡å°‘æ ·æ¿ä»£ç 
- **ç°æœ‰é¡¹ç›®**ï¼šä½¿ç”¨ json_serializable é€æ­¥è¿ç§»

## ç‰ˆæœ¬æ›´æ–°

å½“å‰ç‰ˆæœ¬ 1.6.0 çš„ä¸»è¦ç‰¹æ€§ï¼š
- å®Œæ•´çš„ç©ºå®‰å…¨æ”¯æŒ
- ä¼˜åŒ–çš„é”™è¯¯å¤„ç†æœºåˆ¶
- å¢å¼ºçš„å¤šå­—æ®µè§£æåŠŸèƒ½
- äºŒç»´æ•°ç»„è§£ææ”¯æŒ